machine:
  node:
    version: 4.0.0
  python:
    version: 3.4.2
  environment:
    DJANGO_SETTINGS_MODULE: cpdb.settings.test.circleci
    NODE_ENV: development
database:
  post:
    - psql -c "CREATE EXTENSION postgis;" -d circle_test
dependencies:
  post:
    - npm install -g bower
    - npm run circleci
    - npm run circleci_admin
  override:
    - gem install sass
    - pip install -r requirements.txt
    - pyenv local 2.7.9
    - PYTHON=python2 npm install
    - pyenv local 3.4.2
test:
  pre:
    - python manage.py bower_install
    - python manage.py collectstatic --noinput
  override:
    - coverage run --parallel-mode manage.py test  --noinput --nologcapture --with-timer
    - MOBILE=1 coverage run --parallel-mode manage.py test  --noinput --nologcapture --with-timer
    - npm test
  post:
    - coverage combine
    - coveralls
    - coverage report --omit="/home/ubuntu/virtualenvs/*,common/json_serializer.py"
